{% extends "layout.html" %}
{% block title %} Group Comparison {% endblock %}

<!-- Page Content -->
{% block inpage_title %}
    <span class="display-3">
        Group Comparison<br>
    </span>
    <h4>
        {% for g in info.groups %}
            <tag style="background-color: {{ info.group_colors[loop.index0] }}">{{ g }}</tag>{{ " | " if not loop.last }}
        {% endfor %}
    </h4>
    <br>

{#    <tag class="red"><i class="fas fa-brain"></i> {{ info.network }}</tag>#}
{#    |#}
{#    <tag class="blue"><i class="fas fa-database"></i> {{ info.dataset.name }}</tag>#}
{#    <tag class="green"><i class="fas fa-project-diagram"></i> {{ info.lateral_type }}</tag>#}

{% endblock %}

{% block side_nav %}
    <ul class="list-unstyled components">
        <li class="active-w"><a href="#statistics-view">Training Statistics</a></li>
        <li><a href="#hp-view">Hyperparameters</a></li>
    </ul>
{% endblock %}

{% block page_controls %}
    <div class="reload-button">
        <button type="button" id="refresh" class="btn btn-circle btn-sm">
            <i class="fas fa-sync"></i>
        </button>
    </div>
{% endblock %}

{% block page_content %}

    <div class="topic-group" id="statistics-view">
        <div class="row justify-content-center align-bottom">
            <div class="col col-6">
                <div id="validation-accuracy-plot" style="width:100%">
                    {{ info.accuracy_progress_plot[0]|safe }}
                    {{ info.accuracy_progress_plot[1]|safe }}
                </div>
            </div>

            <div class="col col-6">
                <div id="loss-plot" style="width:100%;">
                    {{ info.loss_progress_plot[0]|safe }}
                    {{ info.loss_progress_plot[1]|safe }}
                </div>
            </div>
        </div>
    </div>

    <div class="topic-group" id="evaluation-view">
        <div class="row justify-content-center align-bottom">

            <div class="col col-12">
                <div id="test-acc-plot" style="width:100%;">
                    {{ info.test_accuracies[0]|safe }}
                    {{ info.test_accuracies[1]|safe }}
                </div>
            </div>

{#            <div class="col col-6 align-bottom">#}
{#                <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">#}
{#                    {% for v in info.evaluated_settings %}#}
{#                        <li class="nav-item" role="presentation">#}
{#                            <a class="nav-link {{ 'active' if (loop.index == 1) else '' }}" id="pills-{{ v }}-tab"#}
{#                               data-toggle="pill" href="#eval-{{ v }}-plot"#}
{#                               role="tab" aria-controls="eval-{{ v }}-plot"#}
{#                               aria-selected="{{ 'true' if loop.index == 0 else 'false' }}">{{ v }} </a>#}
{#                        </li>#}
{#                    {% endfor %}#}
{#                </ul>#}
{##}
{#                <div class="tab-content">#}
{#                    {% for v in info.evaluated_settings %}#}
{#                        <div id="eval-{{ v }}-plot" class="tab-pane fade {{ 'show active' if loop.index == 1 else '' }}"#}
{#                             role="tabpanel" aria-labelledby="eval-{{ v }}-plot-tab"#}
{#                             style="width:100%; height:500px;"></div>#}
{#                    {% endfor %}#}
{#                </div>#}
{#            </div>#}
        </div>
    </div>

<div class="topic-group" id="stat-view">
        <div class="row justify-content-center">
            <div class="col col-12">
                <h4 align="center" class="sub-title">Validation Performance</h4>

                <table class="table table-striped" title="Statistics">
                    <thead>
                    <tr>
                        <th scope="col"></th>
                        {% for g in info.groups %}
                            <th scope="col">{{ g }}</th>
                        {% endfor %}
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>Accuracy</td>
                        {% for g in info.groups %}
                            <td>{{ info.stats.mean_best_val_acc[g] }}</td>
                        {% endfor %}
                    </tr>

                    <tr>
                        <td>Epoch of Best Accuracy</td>
                        {% for g in info.groups %}
                            <td>{{ info.stats.mean_best_val_acc_epoch[g] }}</td>
                        {% endfor %}
                    </tr>

                    <tr>
                        <td>Best Loss</td>
                        {% for g in info.groups %}
                            <td>{{ info.stats.mean_best_val_loss[g] }}</td>
                        {% endfor %}
                    </tr>
                    </tbody>
                </table>
            </div>

            <div class="col col-12">
                <h4 align="center" class="sub-title">Test Performance</h4>

                <table class="table table-striped" title="Statistics">
                    <thead>
                    <tr>
                        <th scope="col"></th>
                        {% for g in info.groups %}
                            <th scope="col">{{ g }}</th>
                        {% endfor %}
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>Default</td>
                        {% for g in info.groups %}
                            <td>{{ info.stats.mean_best_test_acc[g] }} (&#177; {{ info.stats.conf_h_test_acc[g] }})</td>
                        {% endfor %}
                    </tr>

                    <tr>
                        <td>Random Occlusion</td>
                        {% for g in info.groups %}
                            <td>{{ info.stats.mean_best_test_acc_occl[g] }} (&#177; {{ info.stats.conf_h_test_acc_occl[g] }})</td>
                        {% endfor %}
                    </tr>

                    <tr>
                        <td>Contrast Sprinkling</td>
                        {% for g in info.groups %}
                            <td>{{ info.stats.mean_best_test_acc_sprinkle[g] }} (&#177; {{ info.stats.conf_h_test_acc_sprinkle[g] }})</td>
                        {% endfor %}
                    </tr>

                    <tr>
                        <td>Decline From Occlusion</td>
                        {% for g in info.groups %}
                            <td>{{ info.stats.mean_best_test_acc_sprinkle_diff[g] }} (&#177; {{ info.stats.conf_h_test_acc_sprinkle_diff[g] }})</td>
                        {% endfor %}
                    </tr>

                    </tbody>
                </table>
            </div>
        </div>
    </div>

{% endblock %}

{% block js_footer %}
    <script type="text/javascript" src="https://mpld3.github.io/js/d3.v3.min.js"></script>
    <script>
        $('.carousel').carousel();

        $("nav ul li").on("click", function () {
            $("nav").find(".active-w").removeClass("active-w");
            $(this).addClass("active-w");
        });

        $(".reload-button").on("click", function () {
            location.reload();
        });

        {#$("#evaluate-btn").on("click", function () {#}
        {#        $.ajax({#}
        {#            url: "{{ url_for("evaluate_experiments") }}",#}
        {#            type: "POST",#}
        {#            contentType: 'application/json;charset=UTF-8',#}
        {#            data: JSON.stringify({'ids': '{{ info.ids | tojson }}'}),#}
        {#            success: function () {#}
                        {#location.reload();#}
        {#            },#}
        {#            error: function (jqXhr, textStatus, errorMessage) {#}
        {#                console.log(errorMessage);#}
        {#            }#}
        {#        });#}
        {#    }#}
        {#)#}

    </script>
{% endblock %}